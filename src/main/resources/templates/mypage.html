<!DOCTYPE html>
<html lang="kr">
<head>
    {{> include/header}}
    <link rel="stylesheet" type="text/css" href="/style/user.css">
    <style>
        .my-custom-scrollbar {
            position: relative;
            height: 300px;
            overflow: auto;
        }
        .table-wrapper-scroll-y {
            display: block;
        }

    </style>
</head>
<body>
{{> include/navbar}}
<div class="container myPage-container">
    {{> include/mypage_sticker}}
    <div class="shadow-lg myPage-component">
        <div class="mypage-inner-component">
            <div class="row">
                <div class="col-md-4 border-left-primary shadow card mr-3">
                    <div class="card-body row">
                        <i class="col-auto fas fa-id-card text-gray-400 fa-3x align-self-center"></i>
                        <div class="col">
                            <div class="row text-gray-700 font-weight-bolder justify-content-center"
                                 style="font-size: xx-large; letter-spacing: 5px">{{userName}}
                            </div>
                            <div class="dropdown-divider"></div>
                            <div class="row text-gray-500 justify-content-center">
                                {{userNick}}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 border-left-danger shadow card mr-3">
                    <div class="card-body row">
                        <span class="btn-google btn-circle col-auto fa-3x align-self-center">
                                    <i class="fab fa-google"></i>
                        </span>
                        <div class="col text-gray-600 align-self-center" style="font-size: large">
                            {{userId}}
                        </div>

                        <!--                                페북일때-->
                        <!--                                <span class="btn-facebook btn-circle col-auto">-->
                        <!--                                    <i class="fab fa-facebook-f"></i>-->
                        <!--                                </span>-->
                    </div>
                </div>
                <div class="col-md-3 border-left-info shadow card">
                    <div class="card-body row">
                        <i class="col-auto fas fa-mobile-alt text-gray-400  fa-3x align-self-center"></i>
                        <!--                                <div class="col ml-4 mr-2 text-gray-600">-->
                        <!--                                    01072470968-->
                        <!--                                </div>-->
                        <!--                                휴대폰인증안하면-->
                        {{#userPhone}}
                        <button type="button" class="col btn btn-secondary btn-block ml-3 fa-xs align-self-center">
                            {{userPhone}}
                        </button>
                        {{/userPhone}}
                        {{^userPhone}}
                        <button type="button" class="col btn btn-secondary btn-block ml-3 fa-xs align-self-center" data-toggle="modal"
                                data-target="#certifiedModal">휴대폰
                            인증하기
                        </button>
                        {{/userPhone}}

                        <!--                                <button type="button" class="btn btn-success btn-circle ml-4">-->
                        <!--                                    <i class="fas fa-check"></i>-->
                        <!--                                </button>-->
                    </div>
                </div>
            </div>
            <div class="row card shadow border-left-warning mt-3">
                <div class="ml-3 row card-body">
                    <div class="col-auto align-self-center">
                        <div class="row fa-xs text-gray-500 justify-content-center">구매자들의 평가</div>
                        <div class="row justify-content-center">
                            <h1 style="font-size: 48px">{{rateAvg}}</h1>
                        </div>
                    </div>
                    <div class="col-auto vertical-divider"></div>
                    <div class="col table-wrapper-scroll-y my-custom-scrollbar">
                        <table class="table table-bordered table-striped mb-0">
                            <thead>
                            <tr>
                                <th scope="col">날짜</th>
                                <th scope="col">점수</th>
                            </tr>
                            </thead>
                            <tbody>
                            {{#rate}}
                            <tr>
                                <td>{{dateTime}}</td>
                                <td>{{score}}</td>
                            </tr>
                            {{/rate}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="row card shadow border-left-primary mt-3" style="height: 350px">
                <div class="ml-3 card-body">
                    <div class="row" style="height: 100%">
                        <div class="col-auto align-self-center">
                            <div class="row justify-content-center">
                                <div class="fa-xs text-gray-500">보유포인트</div>
                            </div>
                            {{#sum}}
                            <div class="row">
                                <h2 class="col text-center">{{sum}}</h2>
                            </div>
                            {{/sum}}
                            <div class="dropdown-divider"></div>
                            <div class="row justify-content-center">
                                <a href="charge" class="btn btn-primary btn-icon-split">
                                    <span class="icon text-white-50">
                                        <i class="fas fa-battery-three-quarters"></i>
                                    </span>
                                    <span class="text">충전하기</span>
                                </a>
                            </div>
                        </div>
                        <div class="col-auto vertical-divider"></div>
                            <div class="col table-wrapper-scroll-y my-custom-scrollbar">
                                <table class="table table-bordered table-striped mb-0">
                                    <thead>
                                    <tr>
                                        <th scope="col">날짜</th>
                                        <th scope="col">금액</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {{#point}}
                                    <tr>
                                        <th scope="row">{{createDate}}</th>
                                        <td>{{amount}}</td>
                                    </tr>
                                    {{/point}}
                                    </tbody>
                                </table>
                            </div>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-end mt-3">
                <button type="button" class="btn btn-danger btn-icon-split" data-toggle="modal"
                        data-target="#user_delete">
                                    <span class="icon text-white-50">
                                        <i class="fas fa-user-slash"></i>
                                    </span>

                    <span class="text">회원탈퇴</span>
                </button>
            </div>
        </div>
    </div>
</div>
{{>include/Certified_modal}}
{{>include/mypage_delete_modal}}
{{>include/mypage_edit_modal}}
{{>include/footer}}

</body>
<!--휴대폰 인증 모달-->
<div class="modal fade" id="certifiedModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true"
     style="font-family: Noto Sans KR, sans-serif"
>
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header" style="align-items: center">
                <h5 class="modal-title">HOTTHINK 인증센터</h5>
            </div>
            <div class="modal-body">
                <h5 class="text-center">휴대폰 인증</h5>
                <div class="row">
                    <div class="col">
                        <input class="form-control form-control-user" type="text" id="inputPhoneNumber"
                               placeholder="01012345678">
                    </div>
                    <div class="col-auto">
                        <a class="btn btn-secondary" id="sendPhoneNumber" >번호확인</a>
                    </div>
                </div>
                <div class="text-center small mt-2" id="checkMsgNick" style="color: red"></div>

                <hr>

                <div class="row align-items-center">
                    <a id="collapseBtn" class="col-auto btn btn-outline-dark mx-auto" data-toggle="collapse"
                       href="#collapse" role="button" aria-expanded="false" aria-controls="collapseExample">
                        인증번호입력하기
                    </a>
                </div>
                <div class="collapse mt-3" id="collapse">
                    <div class="form-group">
                        <input type="text" class="form-control form-control-user"
                               id="inputCertifiedNumber" placeholder="인증번호입력">
                    </div>

                    <div class="text-center small mt-2" id="checkMsgPW" style="color: red"></div>
                </div>
                <!--                <h5 class="text-center"></h5>-->

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" id="checkBtn">확인</button>
            </div>
        </div>
    </div>
</div>
<script>
        $('#sendPhoneNumber').click(function(){
            let phoneNumber = $('#inputPhoneNumber').val();
            Swal.fire('인증번호 발송 완료!')


            $.ajax({
                type: "GET",
                url: "/check/sendSMS",
                data: {
                    "phoneNumber" : phoneNumber
                },
                success: function(res){
                    $('#checkBtn').click(function(){
                        if($.trim(res) ==$('#inputCertifiedNumber').val()){
                            $.ajax({
                                type: "GET",
                                url: "/update/phone",
                                data: {
                                    "phoneNumber" : $('#inputPhoneNumber').val()
                                }
                            })

                            Swal.fire(
                                '인증성공!',
                                '휴대폰 인증이 정상적으로 완료되었습니다.',
                                'success'
                            ).then((OK)=> {
                                if(OK){
                                    window.location.href= "/user/mypage/home";
                                }
                            })

                        }else{
                            Swal.fire({
                                icon: 'error',
                                title: '인증오류',
                                text: '인증번호가 올바르지 않습니다!',
                                footer: '<a href="/home">다음에 인증하기</a>'
                            })
                        }
                    })


                }
            })
        });

</script>
</html>


